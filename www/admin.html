<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Admin – Mapa de Comida Barrancabermeja</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    body {
      margin: 0;
      font-family: system-ui, sans-serif;
      display: flex;
      height: 100vh;
      background: #f5f5f5;
    }

    #map {
      width: 55%;
      height: 100%;
    }

    .panel {
      width: 45%;
      padding: 20px;
      overflow-y: auto;
      background: white;
      border-left: 2px solid #eee;
    }

    h2 {
      margin-top: 0;
      color: #ff5722;
    }

    label {
      display: block;
      margin-top: 12px;
      font-weight: 600;
    }

    input, textarea, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 8px;
      border: 1px solid #ccc;
    }

    textarea { resize: vertical; }

    .row {
      display: flex;
      gap: 10px;
    }

    .row input {
      flex: 1;
    }

    .checkbox-group {
      display: flex;
      gap: 10px;
      margin-top: 5px;
    }

    button {
      background: #ff5722;
      color: white;
      border: none;
      padding: 10px;
      border-radius: 10px;
      font-size: 16px;
      margin-top: 15px;
      cursor: pointer;
    }

    button.secondary {
      background: #333;
    }

    .menu-item {
      display: flex;
      gap: 8px;
      margin-top: 5px;
    }

    .menu-item input {
      flex: 1;
    }

    pre {
      background: #111;
      color: #0f0;
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
      max-height: 300px;
      overflow-y: auto;
      font-size: 13px;
    }

    @media (max-width: 900px) {
      body { flex-direction: column; }
      #map { width: 100%; height: 40%; }
      .panel { width: 100%; height: 60%; }
    }
  </style>
</head>

<body>

  <!-- MAPA -->
  <div id="map"></div>

  <!-- PANEL -->
  <div class="panel">
    <h2>Agregar Local de Comida</h2>

    <label>Nombre</label>
    <input id="nombre">

    <label>Descripción</label>
    <textarea id="descripcion"></textarea>

    <div class="row">
      <div>
        <label>Latitud</label>
        <input id="lat" readonly>
      </div>
      <div>
        <label>Longitud</label>
        <input id="lng" readonly>
      </div>
    </div>

    <label>Teléfono</label>
    <input id="telefono">

    <label>Dirección</label>
    <input id="direccion">

    <label>Horario</label>
    <input id="horario">

    <label>Domicilio</label>
    <select id="delivery">
      <option value="true">Sí</option>
      <option value="false">No</option>
    </select>

    <label>Métodos de pago</label>
    <div class="checkbox-group">
      <label><input type="checkbox" value="Nequi"> Nequi</label>
      <label><input type="checkbox" value="Efectivo"> Efectivo</label>
      <label><input type="checkbox" value="Tarjeta"> Tarjeta</label>
    </div>

    <label>Rango de precios</label>
    <div class="row">
      <input id="precioMin" placeholder="Mín">
      <input id="precioMax" placeholder="Máx">
    </div>

    <label>Menú</label>
    <div id="menu"></div>
    <button type="button" onclick="agregarMenu()">+ Agregar ítem</button>

    <label>Redes</label>
    <input id="facebook" placeholder="Facebook">
    <input id="instagram" placeholder="Instagram">
    <input id="tiktok" placeholder="TikTok">

    <label>Fotos (URLs separadas por coma)</label>
    <textarea id="fotos"></textarea>

    <button onclick="guardarLocal()">Agregar Local</button>
    <button class="secondary" onclick="exportar()">Exportar JSON</button>

    <pre id="output"></pre>
  </div>

  <!-- Leaflet -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // MAPA
    const map = L.map('map').setView([7.065278, -73.854167], 14);
    L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png").addTo(map);

    let marker = L.marker([7.065278, -73.854167]).addTo(map);
    let locales = [];

    map.on('click', e => {
      const { lat, lng } = e.latlng;
      marker.setLatLng([lat, lng]);
      latInput.value = lat.toFixed(6);
      lngInput.value = lng.toFixed(6);
    });

    const latInput = document.getElementById('lat');
    const lngInput = document.getElementById('lng');

    function agregarMenu() {
      const div = document.createElement('div');
      div.className = "menu-item";
      div.innerHTML = `
        <input placeholder="Nombre">
        <input type="number" placeholder="Precio">
      `;
      document.getElementById('menu').appendChild(div);
    }

    function guardarLocal() {
      const menu = [...document.querySelectorAll('#menu .menu-item')].map(m => ({
        nombre: m.children[0].value,
        precio: Number(m.children[1].value)
      }));

      const pagos = [...document.querySelectorAll('input[type=checkbox]:checked')]
        .map(c => c.value);

      const nuevo = {
        id: Date.now(),
        nombre: nombre.value,
        coords: [Number(lat.value), Number(lng.value)],
        descripcion: descripcion.value,
        telefono: telefono.value,
        direccion: direccion.value,
        horario: horario.value,
        delivery: delivery.value === "true",
        metodos_pago: pagos,
        menu,
        rangos_precios: {
          min: Number(precioMin.value),
          max: Number(precioMax.value)
        },
        redes: {
          facebook: facebook.value || null,
          instagram: instagram.value || null,
          tiktok: tiktok.value || null
        },
        fotos: fotos.value.split(',').map(f => f.trim())
      };

      locales.push(nuevo);
      output.textContent = JSON.stringify({ locales }, null, 2);
    }

    function exportar() {
      const blob = new Blob([JSON.stringify({ locales }, null, 2)], { type: "application/json" });
      const a = document.createElement('a');
      a.href = URL.createObjectURL(blob);
      a.download = "locales.json";
      a.click();
    }
  </script>

</body>
</html>
